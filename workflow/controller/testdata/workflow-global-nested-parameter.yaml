apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: global-nested-parameter-test-
spec:
  entrypoint: step-with-nested-parameter

  arguments:
    parameters:
    - name: adj
      value: "cruel"
    - name: recipient
      value: "world"
    - name: target
      value: "{{workflow.parameters.adj}} {{workflow.parameters.recipient}}"
    - name: nested-target
      value: "{{workflow.parameters.target}}"

  templates:
  - name: echo
    inputs:
      parameters:
      - name: message
    container:
      image: alpine:3.7
      command: [/bin/sh, -c]
      args: ["echo {{inputs.parameters.message}}"]

  - name: step-with-nested-parameter
    template: echo
    arguments:
      parameters:
        - name: message
          value: "{{item}} {{workflow.parameters.nested-target}}"
      withItems: ["Hello", "Goodbye"]